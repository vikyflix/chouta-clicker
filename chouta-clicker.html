<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chouta Clicker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #2c1810, #4a2c1a);
            color: #f4e6d3;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://github.com/vikyflix/chouta-clicker/blob/main/main_background.jpg?raw=true');
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: -1;
            transition: opacity 2s ease;
        }
        .background_storm {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://github.com/vikyflix/chouta-clicker/blob/897d47fcac653ee51658423e8383611e6ce6f8e5/Stormfather.jpg?raw=true');
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: -1;
            transition: opacity 2s ease;
        }

        .background.storm-active {
            opacity: 0.8;
            animation: stormFlash 3s infinite;
        }

        @keyframes stormFlash {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3) saturate(1.2); }
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 300px 300px;
            grid-template-rows: auto 1fr;
            gap: 20px;
            min-height: 100vh;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.7);
            border-radius: 15px;
            border: 2px solid #8b4513;
        }

        .header h1 {
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 2px 2px 4px #000;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            font-style: italic;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .resources {
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #8b4513;
        }

        .resource {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #444;
            font-size: 1.1em;
        }

        .resource:last-child {
            border-bottom: none;
        }

        .click-area {
            text-align: center;
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #8b4513;
        }

        .chouta-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff6b35, #d84315);
            border: 4px solid #8b4513;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .chouta-button:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 24px rgba(0,0,0,0.7);
        }

        .chouta-button:active {
            transform: scale(0.95);
        }

        .click-power {
            font-size: 1.1em;
            margin-top: 10px;
        }

        .buildings, .upgrades {
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #8b4513;
            max-height: 70vh;
            overflow-y: auto;
        }
        .multi-buy-button-container {
            display: flex;
            gap: 5px; /* space between buttons */
            flex-wrap: wrap; /* allows wrapping if too wide */
        }
        .building-multi-buy{
            display: inline;
            background: rgba(139, 69, 19, 0.3);
            border: 1px solid #8b4513;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            flex-wrap: wrap;
        }

        .section-title {
            font-size: 1.4em;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #8b4513;
            padding-bottom: 10px;
        }

        .building-multi-buy:hover {
            background: rgba(139, 69, 19, 0.5);
            transform: translateX(5px);
        }

        .building, .upgrade{
            background: rgba(139, 69, 19, 0.3);
            border: 1px solid #8b4513;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .building:hover, .upgrade:hover {
            background: rgba(139, 69, 19, 0.5);
            transform: translateX(5px);
        }


        .building.affordable, .upgrade.affordable {
            border-color: #32cd32;
            box-shadow: 0 0 5px rgba(50, 205, 50, 0.3);
        }

        .building-header, .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .building-name, .upgrade-name .building-multi-buy{
            font-weight: bold;
            color: #ffd700;
        }

        .building-count {
            background: rgba(0,0,0,0.7);
            color: #ffd700;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
        }

        .building-cost, .upgrade-cost {
            font-weight: bold;
            color: #ff6b35;
        }

        .building-desc, .upgrade-desc {
            font-size: 0.9em;
            color: #ccc;
            line-height: 1.3;
        }

        .storm-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
        }
        .bridgerun-indicator {
            position: fixed;
            top: 160px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
        }

        .storm-status {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .bridgerun-status {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .storm-timer {
            background: #333;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .bridgerun-timer {
            background: #333;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .storm-progress {
            height: 100%;
            background: linear-gradient(90deg, #00bcd4, #80deea);
            transition: width 1s linear;
        }

        .bridgerun-progress {
            height: 100%;
            background: linear-gradient(90deg, #00bcd4, #80deea);
            transition: width 1s linear;
        }

        .stormlight-bar {
            background: #333;
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
            position: relative;
        }

        .bridgerun-bar {
            background: #333;
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
            position: relative;
        }

        .stormlight-fill {
            height: 100%;
            background: linear-gradient(90deg, #6de8ff, #c8f5ff);
            transition: width 0.3s ease;
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: #ffd700;
            padding: 20px 40px;
            border-radius: 10px;
            border: 2px solid #ffd700;
            font-size: 1.5em;
            z-index: 1000;
            animation: notificationPop 3s ease;
        }

        @keyframes notificationPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            20% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
            }
            
            .buildings, .upgrades {
                max-height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="background" id="background"></div>
    
    <div class="game-container">
        <div class="header">
            <h1>Chouta Clicker</h1>
            <p>Chouta is the best! Click to cook, serve, and feed your fellow airsick lowlanders.</p>
        </div>

        <div class="main-area">
            <div class="resources">
                <div class="section-title">Resources</div>
                <div class="resource">
                    <span>Chouta</span>
                    <span id="chouta-count">0</span>
                </div>
                <div class="resource">
                    <span>Chouta per Second</span>
                    <span id="cps">0</span>
                </div>
                <div class="resource">
                    <span>Infused Spheres</span>
                    <span id="spheres-count">10</span>
                </div>
                <div class="resource">
                    <span>Stormlight Stored</span>
                    <span id="stormlight-count">0</span>
                </div>
            </div>

            <div class="click-area">
                <button class="chouta-button" id="chouta-button">
                    Cook Chouta!
                </button>
                <div class="click-power">
                    Click Power: <span id="click-power">1</span>
                </div>
            </div>
        </div>

        <div class="buildings">
            <div class="section-title">Buildings</div>
            <div class="multi-buy-button-container" id="multi-buy-button-container">
                <div class="building-multi-buy" id="multi10"> x10 </div>
                <div class="building-multi-buy" id="multi100"> x100 </div>
                <div class="building-multi-buy" id="multiMax"> Max </div>
                <div class="building-multi-buy" id="x">    X </div>
                <div class="building-multi-buy" id="reset">RESET</div>
            </div>

            <div id="buildings-list"></div>
        </div>

        <div class="upgrades">
            <div class="section-title">Upgrades</div>
            <div id="upgrades-list"></div>
        </div>
    </div>

    <div class="storm-indicator">
        <div class="storm-status" id="storm-status">Highstorm Inactive</div>
        <div class="storm-timer">
            <div class="storm-progress" id="storm-progress"></div>
        </div>
        <div>Stormlight Storage:</div>
        <div class="stormlight-bar">
            <div class="stormlight-fill" id="stormlight-fill"></div>
        </div>
    </div>

    <div class="bridgerun-indicator">
        <div class="bridgerun-status" id="bridgerun-status">Bridgerun Inactive</div>
        <div class="bridgerun-timer">
            <div class="bridgerun-progress" id="bridgerun-progress"></div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            chouta: 0,
            spheres: 0,
            stormlightStored: 0,
            clickPower: 1, //clickPower changed for dev pourposes
            clickModifier:1,
            costModifier:1,
            stormActive: false,
            stormTimer: 0,
            stormDuration: 60, // 
            calmDuration: 180,  //
            bridgeRunDuration: [10,20],
            bridgeCalmDuration: [10,20],
            bridgeRunCurrentDuration: 0,
            bridgeCalmCurrentDuration: 0,
            bridgeRunTimer:0,
            bridgeCalmTimer:0,
            bridgeRunCountdown:0,
            bridgeRunActive: false,
            buildings: {},
            upgrades: {},
            multiBuy: 1,
            totalCps: 0
        };

        // Building Definitions
        const buildingTypes = {
            
            yieldAdminChouta: {
                name: "Admin CHOUTA",
                desc: "Rich Chouta",
                amount: 100000000000,
                isAdmin: true,
                baseCost: 0,
                baseProduction: 0,
                stormProduction: 0,
                requirements:[[]],
                type: "building"
            },
            /*
            yieldAdminSphere: {
                name: "Admin SPHERES",
                desc: "Rich Sphere",
                amount: 1,
                isAdmin: true,
                baseCost: 0,
                baseProduction: 0,
                stormProduction: 0,
                requirements:[[]],
                type: "building"
            },
            loseAdminStormlight: {
                name: "Admin Lose Stormlight",
                desc: "Remove Stormlight",
                amount: 100,
                isAdmin: true,
                baseCost: 0,
                baseProduction: 0,
                stormProduction: 0,
                requirements:[[]],
                type: "building"
            },
            */
            cookpotFires: {
                name: "Cookpot Fires",
                desc: "Small flames at the warcamp edges, tended by whoever can hold a ladle.",
                baseCost: 15,
                baseProduction: 1.0,
                stormProduction: 0.5,
                requirements:[[]],
                type: "building"
            },
            slaveParshmen: {
                name: "Parshmen",
                desc: "Best Slaves ever known, they click for you.",
                baseCost: 50,
                baseProduction: gameState.clickPower,
                stormProduction: 0.5,
                requirements:[[]],
                type: "building"
            },
            bridgeboysCooks: {
                name: "Bridgeboys Cooks", 
                desc: "Even bridgemen need to eat—one pot feeds many, if barely enough.",
                baseCost: 250,
                baseProduction: 2.4,
                stormProduction: 1.2,
                requirements:[[]],
                type: "building"
            },
            choutaBaziers: {
                name: "Chouta Braziers",
                desc: "Big, battered braziers glow with Herdazian spice and oil.",
                baseCost: 500,
                baseProduction: 5.0,
                stormProduction: 2.5,
                requirements:[[]],
                type: "building"
            },
            spiceGrinders: {
                name: "Spice-grinders of Herdaz",
                desc: "The secret's in the seasoning. Too much, and even a lighteyes weeps.",
                baseCost: 1200,
                baseProduction: 12.0,
                stormProduction: 6.0,
                requirements:[[]],
                type: "building"
            },
            rockCook: {
                name: "Numuhukumakiaki'aialunamor",
                desc: "Take everything you have, and put him in pot. Don't let anyone airsick touch seasonings.",
                baseCost: 3000,
                baseProduction: 30.0,
                stormProduction: 15.0,
                requirements:[[]],
                type: "building"
            },
            lopensCousins: {
                name: "Lopen's Cousins",
                desc: "A man can never have enough cousins.",
                baseCost: 7500,
                baseProduction: 80.0,
                stormProduction: 40.0,
                requirements:[[]],
                type: "building"
            },
            rocksFamily: {
                name: "Rock's Horneater Family",
                desc: "Rock brings his whole Horneater family to help. Huge production line.",
                baseCost: 20000,
                baseProduction: 200.0,
                stormProduction: 100.0,
                requirements:[[]],
                type: "building"
            },
            bridgeCrews: {
                name: "The Bridge Crews",
                desc: "Condemned to bear the weight of another man's war, they run toward death so others may walk away. Every gap they fill is paid for in blood, sweat, and the shreds of freedom they’ll never see again.",
                baseCost: 20000,
                baseProduction: -200.0,
                stormProduction: -400.0,
                requirements:[["rocksFamily",10]],
                type: "building"

            },
            bridgeCrewsExtra: {
                name: "The Burdenbearers",
                desc: "Ten crews now march beneath the weight of wood and war. The deaths still come, the screams still echo… yet, for the first time, some run not only to survive but to bring the others home.",
                baseCost: 40000,
                baseProduction: -400.0,
                stormProduction: -800.0,
                requirements:[["bridgeCrews",10]],
                type: "building"
            },
            bridgeFour: {
                name: "Bridge Four",
                desc: "It appeared that he'd been wrong. There had been something more they could do to him. One final torment the world had reserved just for Kaladin. And it was called Bridge Four.",
                baseCost: 80000,
                baseProduction: -800.0,
                stormProduction: -1600.0,
                requirements:[["bridgeCrewsExtra",20]],
                type: "building"
            }
            
        };

        // Upgrade Definitions
        const upgradeTypes = {
            betterLadleUpgrade: {
                name: "Better Ladle",
                desc: "A proper cooking utensil makes all the difference.",
                cost: 1000,
                requirements:[[]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickModifier+=2
                    showNotification("Click power increased!");
                }
            },
            clickPowertoCPS: {
                name: "The Way of the Radiant",
                desc: "Your clicks are infused with purpose, converting a fraction of your Chouta-per-Second into additional click power.",
                cost: 10000,
                requirements:[["betterLadleUpgrade", true],["upgradedCooks",true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower += (gameState.totalCps / 100);
                    showNotification("Strength Before Weakness!");
                }
            },
            cheaperBuildings: {
                name: "War Camp Efficiency",
                desc: "A team of scribes and quartermasters streamlines supply chains, allowing for the construction of buildings at a reduced cost.",
                cost: 50000,
                requirements:[["choutaBaziers", 10]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.costModifier=0.1
                    showNotification("Supply chains streamlined! Building costs reduced.");
                            }
            },
            shardbladeLadle: {
                name: "Shardladle",
                desc: "An ancient cooking implement that cuts through the toughest rockbud shells with ease.",
                cost: 2500,
                requirements:[["betterLadleUpgrade", true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickModifier+=2;
                    showNotification("The Shardladle hums with power!");
                }
            },


            flamesprenFires: {
                name: "Flamespren-Blessed Cookfires",
                desc: "Little dancing flames whisper cooking secrets to those who listen.",
                cost: 800,
                requirements:[["cookpotFires", 5]],
                type: "upgrade", 
                bought: false,
                effect: () => {
                    buildingTypes["cookpotFires"].baseProduction *= 2;
                    buildingTypes["cookpotFires"].stormProduction = buildingTypes["cookpotFires"].baseProduction / 2;
                    showNotification("Flamespren dance around your fires!");
                    renderBuildings();
                }
            },

            windsprenSeasoning: {
                name: "Windspren-Carried Spices",
                desc: "Playful spren carry exotic seasonings from across the Shattered Plains.",
                cost: 3000,
                requirements:[["spiceGrinders", 3]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    buildingTypes["spiceGrinders"].baseProduction *= 2;
                    buildingTypes["spiceGrinders"].stormProduction = buildingTypes["spiceGrinders"].baseProduction / 2;
                    showNotification("Windspren giggle as they season your chouta!");
                    renderBuildings();
                }
            },

            vorinPurityCodes: {
                name: "Vorin Purity Codes",
                desc: "Following proper Vorin cooking methods improves efficiency, even if it's technically women's work.",
                cost: 1500,
                requirements:[["choutaBaziers", 8]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    buildingTypes["choutaBaziers"].baseProduction *= 2;
                    buildingTypes["choutaBaziers"].stormProduction = buildingTypes["choutaBaziers"].baseProduction / 2;
                    showNotification("Honor guides your cooking techniques!");
                    renderBuildings();
                }
            },

            horneaterSecrets: {
                name: "Horneater Cooking Secrets",
                desc: "Rock teaches proper Horneater ways. Is making airsick lowlanders less airsick, yes?",
                cost: 8000,
                requirements:[["rockCook", 1]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    buildingTypes["rockCook"].baseProduction *= 2;
                    buildingTypes["rockCook"].stormProduction = buildingTypes["rockCook"].baseProduction / 2;
                    showNotification("Rock shares ancient Horneater wisdom!");
                    renderBuildings();
                }
            },

            herdazianNetworking: {
                name: "Herdazian Trade Networks", 
                desc: "The Lopen knows a guy who knows a guy who has the best ingredients, gon.",
                cost: 12000,
                requirements:[["lopensCousins", 5]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    buildingTypes["lopensCousins"].baseProduction *= 2;
                    buildingTypes["lopensCousins"].stormProduction = buildingTypes["lopensCousins"].baseProduction / 2;
                    showNotification("The Lopen's network delivers the goods!");
                    renderBuildings();
                }
            },

            peaksprenBlessing: {
                name: "Peakspren Mountain Blessing",
                desc: "Ancient spirits of the Horneater Peaks bless your family recipes.",
                cost: 40000,
                requirements:[["rocksFamily", 10]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    buildingTypes["rocksFamily"].baseProduction *= 2.2;
                    buildingTypes["rocksFamily"].stormProduction = buildingTypes["rocksFamily"].baseProduction / 2;
                    showNotification("The peaks remember their children!");
                    renderBuildings();
                }
            },

            stormblessed: {
                name: "Stormblessed Cooking",
                desc: "Life before death. Strength before weakness. Journey before destination. Also, chouta before everything else.",
                cost: 100000,
                requirements:[["bridgeFour", 1]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickModifier*= 3;
                    Object.keys(buildingTypes).forEach(key => {
                        if (buildingTypes[key].baseProduction > 0) {
                            buildingTypes[key].baseProduction *= 2;
                            buildingTypes[key].stormProduction = buildingTypes[key].baseProduction / 2;
                        }
                    });
                    showNotification("Honor radiates from your chouta!");
                    renderBuildings();
                }
            },
            herdazianSpiceUpgrade: {
                name: "Herdazian Spice Blend",
                desc: "Secret family recipe passed down for generations.",
                cost: 5000,
                requirements:[["lopensCousins",10]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower += 2;
                    showNotification("Click power greatly increased!");
                }
            },
            bridgeCrewsUpgrade: {
                name: "Bridge Crews",
                desc: "Unlocks the doomed Bridge Boys.",
                cost: 5000,
                requirements:[["herdazianSpiceUpgrade",true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower += 2;
                    showNotification("Shattered Plains Bridges Unlocked");
                }
            },
            increaseClickPower: {
                name: "Double Your Cooking Force",
                desc: "Cook More Chouta!!! (x2).",
                cost: 5000,
                requirements:[["betterLadleUpgrade",true],["herdazianSpiceUpgrade",true],["cookpotFires",10]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower *= 2;
                    showNotification("Shattered Plains Bridges Unlocked");
                }
            },
            upgradedCooks: {
                name: "Cooks get Better in their job",
                desc: "Cooks double yield (x2).",
                cost: 10000,
                requirements:[["cookpotFires",20]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    const buildings=buildingTypes;
                    buildings["cookpotFires"].baseProduction *= 2;
                    buildings["cookpotFires"].stormProduction = buildings["cookpotFires"].baseProduction/2;
                    showNotification("Production Doubled");
                    renderBuildings();
                }
            },
            upgradedCooks2: {
                name: "Cooks get even BETTER!!",
                desc: "Cooks double yield (x2).",
                cost: 10000,
                requirements:[["cookpotFires",40]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    const buildings=buildingTypes;
                    buildings["cookpotFires"].baseProduction *= 2;
                    buildings["cookpotFires"].stormProduction = buildings["cookpotFires"].baseProduction/2;
                    showNotification("Production Doubled");
                    renderBuildings();
                }
            },
            clickUpgrade4: {
                name: "Test Unlock",
                desc: "Req Test.",
                cost: 5000,
                requirements:[["bridgeCrewsUpgrade",true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower += 2;
                    showNotification("Shattered Plains Bridges Unlocked");
                }
            },
            clickUpgrade5: {
                name: "Test Unlock2",
                desc: "Req Test.",
                cost: 5000,
                requirements:[["bridgeCrewsUpgrade",true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower += 2;
                    showNotification("Shattered Plains Bridges Unlocked");
                }
            },
            clickUpgrade6: {
                name: "Test Unlock3",
                desc: "Req Test.",
                cost: 5000,
                requirements:[["bridgeCrewsUpgrade",true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    gameState.clickPower += 2;
                    showNotification("Shattered Plains Bridges Unlocked");
                }
            },
            squiresUpgrade: {
                name: "Squires of Stormblessed",
                desc: "Make your bridgemen live longer",
                cost: 5000,
                requirements:[["bridgeFour",10]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    showNotification("Life Before Death Radiant!");
                }
            },
            betterSpheres: {
                name: "Cut & Polished Spheres",
                desc: "Each sphere now holds more Stormlight.",
                cost: 10000,
                requirements:[["clickUpgrade6",true]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    // Increases stormlight capacity
                    showNotification("Sphere quality improved!");
                }
            },
            //NEXT LEVEL UPGRADES
            cookpotx10: {
                name: "Even More Cookpot Fires (x10)",
                desc: "",
                cost: 10000,
                requirements:[["cookpotFires",60]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    const buildings=buildingTypes;
                    buildings["cookpotFires"].baseProduction *= 10;
                    buildings["cookpotFires"].stormProduction = buildings["cookpotFires"].baseProduction/2;
                    showNotification("Production Doubled");
                    renderBuildings();
                }
            },
            parshmenx10: {
                name: "More Slave Efficency (x10)",
                desc: "",
                cost: 10000,
                requirements:[["slaveParshmen",60]],
                type: "upgrade",
                bought: false,
                effect: () => {
                    const buildings=buildingTypes;
                    buildings["slaveParshmen"].baseProduction *= 10;
                    buildings["slaveParshmen"].stormProduction = buildings["slaveParshmen"].baseProduction/2;
                    showNotification("Production Doubled");
                    renderBuildings();
                }
            },
        };

        // Initialize buildings
        Object.keys(buildingTypes).forEach(key => {
            gameState.buildings[key] = 0;
        });

        // DOM Elements
        const elements = {
            choutaCount: document.getElementById('chouta-count'),
            cps: document.getElementById('cps'),
            spheresCount: document.getElementById('spheres-count'),
            stormlightCount: document.getElementById('stormlight-count'),
            clickPower: document.getElementById('click-power'),
            choutaButton: document.getElementById('chouta-button'),
            buildingsList: document.getElementById('buildings-list'),
            upgradesList: document.getElementById('upgrades-list'),
            stormStatus: document.getElementById('storm-status'),
            stormProgress: document.getElementById('storm-progress'),
            stormlightFill: document.getElementById('stormlight-fill'),
            bridgerunStatus: document.getElementById('bridgerun-status'),
            bridgerunProgress: document.getElementById('bridgerun-progress'),
            bridgerunFill: document.getElementById('bridgerun-fill'),
            background: document.getElementById('background'),
            buildingx10: document.getElementById('multi10'),
            buildingx100: document.getElementById('multi100'),
            buildingMax: document.getElementById('multiMax'),
            multiBuyContainer: document.getElementById("multi-buy-button-container"),
            removeMultiBuy: document.getElementById("x"),
            reset: document.getElementById("reset")
        };

        // Click handler
        elements.choutaButton.addEventListener('click', () => {
            gameState.chouta += calculateClickPower();

            updateDisplay();
            renderBuildings();
            renderUpgrades();
        });

        elements.buildingx10.addEventListener('click', () => {
            gameState.multiBuy=10;
            elements.buildingx10.style.backgroundColor= "rgba(139, 69, 19, 0.5)";
            elements.buildingx100.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingMax.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.border= "1px solid #32cd32";
            elements.buildingx100.style.border= "1px solid #8b4513";
            elements.buildingMax.style.border= "1px solid #8b4513";
            updateDisplay();
            renderBuildings();
            renderUpgrades();
        });
        elements.buildingx100.addEventListener('click', () => {
            gameState.multiBuy=100;
            elements.buildingx100.style.backgroundColor= "rgba(139, 69, 19, 0.5)";
            elements.buildingMax.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.border= "1px solid #8b4513";
            elements.buildingx100.style.border= "1px solid #32cd32";
            elements.buildingMax.style.border= "1px solid #8b4513";
            updateDisplay();
            renderBuildings();
            renderUpgrades();
        });
        elements.buildingMax.addEventListener('click', () => {
            gameState.multiBuy="max";
            elements.buildingMax.style.backgroundColor= "rgba(139, 69, 19, 0.5)";
            elements.buildingx100.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.border= "1px solid #8b4513";
            elements.buildingx100.style.border= "1px solid #8b4513";
            elements.buildingMax.style.border= "1px solid #32cd32";
            updateDisplay();
            renderBuildings();
            renderUpgrades();
        });
        elements.removeMultiBuy.addEventListener('click', () => {
            gameState.multiBuy="1";
            elements.buildingMax.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx100.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.backgroundColor= "rgba(139, 69, 19, 0.3)";
            elements.buildingx10.style.border= "1px solid #8b4513";
            elements.buildingx100.style.border= "1px solid #8b4513";
            elements.buildingMax.style.border= "1px solid #8b4513";
            updateDisplay();
            renderBuildings();
            renderUpgrades();
        });
        elements.reset.addEventListener('click', () => {
            resetGame();
        });

        // Track pressed keys
        const keysPressed = new Set();

        // Key down handler
        onkeydown = (event) => {
            keysPressed.add(event.code);
            
            // Check combinations in order of complexity (most specific first)
            if (keysPressed.has("ControlLeft") && keysPressed.has("ShiftLeft") && keysPressed.has("AltLeft")) {
                gameState.multiBuy = "max";
                elements.buildingMax.style.border= "1px solid #32cd32";
                elements.buildingx10.style.border= "1px solid #8b4513";
                elements.buildingx100.style.border= "1px solid #8b4513";
                console.log("Multi Max");
            } else if (keysPressed.has("ControlLeft") && keysPressed.has("ShiftLeft")) {
                gameState.multiBuy = 100;
                elements.buildingx100.style.border= "1px solid #32cd32";
                elements.buildingx10.style.border= "1px solid #8b4513";
                elements.buildingMax.style.border= "1px solid #8b4513";
                console.log("Multi 100");
            } else if (keysPressed.has("ControlLeft")) {
                gameState.multiBuy = 10;
                elements.buildingx10.style.border= "1px solid #32cd32";
                elements.buildingx100.style.border= "1px solid #8b4513";
                elements.buildingMax.style.border= "1px solid #8b4513";
                console.log("Multi 10");
            }
        }

        // Key up handler to remove keys from tracking
        onkeyup = (event) => {
            keysPressed.delete(event.code);
            
            // Reset to default when no modifier keys are pressed
            if (!keysPressed.has("ControlLeft")) {
                gameState.multiBuy = 1; // or whatever your default is
                elements.buildingx10.style.border= "1px solid #8b4513";
                elements.buildingx100.style.border= "1px solid #8b4513";
                elements.buildingMax.style.border= "1px solid #8b4513";
            }
        }


        // Calculate total CPS
        function calculateCps() {
            let total = 0;
            Object.keys(buildingTypes).forEach(key => {
                const building = buildingTypes[key];
                const count = gameState.buildings[key];
                
                if (key === 'slaveParshmen') {
                    // Dynamic production based on current click power
                    const production = gameState.stormActive ? 0.5 : gameState.clickPower;
                    total += count * production;
                } else {
                    // Normal building logic
                    const production = gameState.stormActive ? building.stormProduction : building.baseProduction;
                    total += count * production;
                }
            });
            gameState.totalCps = total;
        }

        // Production tick (every second)
        function productionTick() {
            calculateCps();
            gameState.chouta += gameState.totalCps;
            updateDisplay();
            renderBuildings();
            renderUpgrades();
        }

        // Storm system
        function updateStorm() {
            const cycleDuration = gameState.stormDuration + gameState.calmDuration;
            gameState.stormTimer = (gameState.stormTimer + 1) % cycleDuration;

            if (!gameState.stormActive && gameState.stormTimer === gameState.calmDuration) {
                // Storm starts
                gameState.stormActive = true;
                elements.stormStatus.textContent = "Highstorm Active";
                elements.background.classList.add('storm-active');
                elements.background.classList.add('background_storm');
                showNotification("STORM RISES!");
                
                // Fill stormlight during storm
                const maxStormlight = gameState.spheres * 100;
                gameState.stormlightStored = Math.min(maxStormlight, gameState.stormlightStored + maxStormlight * 0.8);
            } else if (gameState.stormActive && gameState.stormTimer === 0) {
                // Storm ends
                gameState.stormActive = false;
                elements.stormStatus.textContent = "Highstorm Inactive";
                elements.background.classList.remove('storm-active');
                elements.background.classList.remove('background_storm');
                showNotification("Storm passes...");
            }

            // Update storm progress bar
            let progress;
            if (gameState.stormActive) {
                progress = ((gameState.stormTimer - gameState.calmDuration) / gameState.stormDuration) * 100;
            } else {
                progress = (gameState.stormTimer / gameState.calmDuration) * 100;
            }
            elements.stormProgress.style.width = progress + '%';

            // Update stormlight bar
            const stormlightPercent = (gameState.stormlightStored / (gameState.spheres * 100)) * 100;
            elements.stormlightFill.style.width = Math.min(100, stormlightPercent) + '%';
        }

        function updateBridgeRun() {
            // Decrement the current timer
            if(gameState.buildings["bridgeCrews"]>0){
                let progress;
                if (gameState.bridgeRunActive) {
                    progress = ((gameState.bridgeRunCurrentDuration - gameState.bridgeRunCountdown) / gameState.bridgeRunCurrentDuration) * 100;
                    console.log("Bridge run progress:", progress, "Duration:", gameState.bridgeRunCurrentDuration, "Countdown:", gameState.bridgeRunCountdown);
                    
                } else {
                    progress = ((gameState.bridgeCalmCurrentDuration - gameState.bridgeRunCountdown) / gameState.bridgeCalmCurrentDuration) * 100;
                    console.log("Bridge calm progress:", progress, "Duration:", gameState.bridgeCalmCurrentDuration, "Countdown:", gameState.bridgeRunCountdown);
                }
                elements.bridgerunProgress.style.width = progress + '%';
                if (gameState.bridgeRunCountdown > 0 ) {
                    gameState.bridgeRunCountdown--;
                    console.log(gameState.bridgeRunCountdown)
                    return;
                }

                // Timer reached zero - trigger state change
                if (!gameState.bridgeRunActive) {
                    // Start a bridge run
                    gameState.bridgeRunActive = true;
                    gameState.bridgeRunCurrentDuration = gameState.bridgeRunDuration[getRandomInt(2)];
                    gameState.bridgeRunCountdown = gameState.bridgeRunCurrentDuration;
                    elements.bridgerunStatus.textContent = "Bridgerun Ongoing";
                    console.log("CALLING FOR A BRIDGERUN");
                    console.log(gameState.bridgeRunCountdown)
                } else {
                    // End the bridge run
                    bridgeRun("bridgeCrews");
                    bridgeRun("bridgeCrewsExtra");
                    bridgeRun("bridgeFour");
                    gameState.bridgeRunActive = false;
                    gameState.bridgeCalmCurrentDuration = gameState.bridgeCalmDuration[getRandomInt(2)];
                    gameState.bridgeRunCountdown = gameState.bridgeCalmCurrentDuration;
                    elements.bridgerunStatus.textContent = "Bridgerun Chill!";
                    console.log("Bridge run complete");
                    console.log(gameState.bridgeRunCountdown)
                }
            }

            // Update stormlight bar
            //const stormlightPercent = (gameState.stormlightStored / (gameState.spheres * 100)) * 100;
            //elements.stormlightFill.style.width = Math.min(100, stormlightPercent) + '%';
        }

        // Buy building
        function buyBuilding(type) {
            const building = buildingTypes[type];
            const currentCount = gameState.buildings[type];
            var cost = calculateCost(type);
            
            if (building.isAdmin){
                if(building.name=="Admin SPHERES"){
                    gameState.spheres += building.amount;
                    updateDisplay();
                }else if(building.name=="Admin CHOUTA"){
                    gameState.chouta += building.amount;
                    updateDisplay();
                }else if(building.name=="Admin Lose Stormlight"){
                    gameState.stormlightStored -= building.amount;
                    updateDisplay();
                }

            }

            if(gameState.multiBuy == "max"){
                let purchased = 0;
                //let maxIterations = 10000; // Safety limit to prevent infinite loops
                
                // Since cost increases with each purchase, use while loop
                while(gameState.chouta >= cost /*&& purchased < maxIterations*/) {
                    gameState.chouta -= cost;
                    gameState.buildings[type]++;
                    purchased++;
                    
                    // Recalculate cost for next iteration (you'll need to replace this with your actual cost formula)
                    cost = Math.floor(building.baseCost * Math.pow(1.15, gameState.buildings[type]));
                    console.log(cost + " LOOP")
                }
                
                
                // Only update displays once after all purchases
                if (purchased > 0) {
                    updateDisplay();
                    renderBuildings();
                    renderUpgrades();
                }
                
            } else if (gameState.chouta >= cost * gameState.multiBuy) {

                gameState.chouta -= cost * gameState.multiBuy;
                gameState.buildings[type] += gameState.multiBuy;
                
                updateDisplay();
                renderBuildings();
                renderUpgrades();
            }
        }

        // Buy upgrade
        function buyUpgrade(type) {
            const upgrade = upgradeTypes[type];
            if (gameState.chouta >= upgrade.cost && !gameState.upgrades[type]) {
                gameState.chouta -= upgrade.cost;
                gameState.upgrades[type] = true;
                upgrade.bought=true;
                upgrade.effect();
                requirementChecker(type);
                updateDisplay();
                renderUpgrades();
            }
        }

        // Render buildings
        function renderBuildings() {
            elements.buildingsList.innerHTML = '';
            Object.keys(buildingTypes).forEach(key => {
                const building = buildingTypes[key];
                if(!requirementChecker(building.requirements)) return;
                const count = gameState.buildings[key];
                const cost = calculateCost(key)
                const canAfford = gameState.chouta >= cost;
                const buildingDiv = document.createElement('div');
                buildingDiv.className = `building ${canAfford ? 'affordable' : ''}`;
                buildingDiv.onclick = () => buyBuilding(key);

                buildingDiv.innerHTML = `
                    <div class="building-header">
                        <span class="building-name">${building.name}</span>
                        <span class="building-count">${count}</span>
                    </div>
                    <div class="building-cost">${cost.toLocaleString()} chouta</div>
                    <div class="building-desc">${building.desc}</div>
                    <div style="margin-top: 5px; font-size: 0.8em; color: #ffd700;">
                        Production: ${building.baseProduction}/sec (${building.stormProduction}/sec during storms)
                    </div>
                `;
                elements.buildingsList.appendChild(buildingDiv);
            });
        }

        // Render upgrades
        function renderUpgrades() {
            elements.upgradesList.innerHTML = '';
            Object.keys(upgradeTypes).forEach(key => {
                if (gameState.upgrades[key]) return; // Already bought

                const upgrade = upgradeTypes[key];
                if(!requirementChecker(upgrade.requirements)) return;

                const canAfford = gameState.chouta >= upgrade.cost;

                const upgradeDiv = document.createElement('div');
                upgradeDiv.className = `upgrade ${canAfford ? 'affordable' : ''}`;
                upgradeDiv.onclick = () => buyUpgrade(key);

                upgradeDiv.innerHTML = `
                    <div class="upgrade-header">
                        <span class="upgrade-name">${upgrade.name}</span>
                    </div>
                    <div class="upgrade-cost">${upgrade.cost.toLocaleString()} chouta</div>
                    <div class="upgrade-desc">${upgrade.desc}</div>
                `;
                elements.upgradesList.appendChild(upgradeDiv);
            });
        }

        // Update display
        function updateDisplay() {
            elements.choutaCount.textContent = Math.floor(gameState.chouta).toLocaleString();
            elements.cps.textContent = gameState.totalCps.toFixed(1);
            elements.spheresCount.textContent = gameState.spheres.toLocaleString();
            elements.stormlightCount.textContent = Math.floor(gameState.stormlightStored).toLocaleString();
            elements.clickPower.textContent = calculateClickPower();
        }

        // Show notification
        function showNotification(text) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = text;
            document.body.appendChild(notification);
            setTimeout(() => document.body.removeChild(notification), 3000);
        }

        // Game loop
        function gameLoop() {
            productionTick();
            updateStorm();
            updateBridgeRun();
            saveGame();

        }

        // Initialize game
        loadGame();
        renderBuildings();
        renderUpgrades();
        updateDisplay();

        // Start game loops
        setInterval(gameLoop, 1000); // Main game loop every second
        setInterval(updateDisplay, 100); // Display updates more frequently

        function requirementChecker(requirements){
            for (let req of requirements) {
                if (req.length === 0) continue;
                const [name, amount] = req;
                //Check buildings
                if (gameState.buildings[name] != undefined) {
                    if (gameState.buildings[name] < amount) return false;
                }else if (gameState.upgrades[name] != undefined) {
                    if (!gameState.upgrades[name] ) return false;
                }else{
                    return false;
                }
            }
            return true; // All requirements met
        }
        function bridgeRun(crew){

            let survived = false
            console.log(gameState.upgrades["squiresUpgrade"])
            if(crew==="bridgeCrews"){
                
                // Check if we have stormlight to consume
                const hasStormlight = gameState.stormlightStored >= gameState.buildings[crew] && gameState.upgrades["squiresUpgrade"];
                
                if(hasStormlight) {
                    // Consume 1 stormlight per building
                    gameState.stormlightStored -= gameState.buildings[crew];
                    // Much better survival chance with stormlight (only 10% death rate)
                    if (Math.random() >=  0.88){
                        console.log("Ded (with stormlight)")
                        if(gameState.buildings[crew]>0){
                            gameState.buildings[crew]--
                        }
                    } else {
                        console.log("Survived (with stormlight)")
                        gameState.spheres += 1*gameState.buildings[crew]
                    }
                } else {
                    // No stormlight - much higher death rate (80% death rate)
                    if (Math.random() >= 0.1){
                        console.log("Ded (no stormlight)")
                        if(gameState.buildings[crew]>0){
                            gameState.buildings[crew]--
                        }
                    } else {
                        console.log("Survived (no stormlight)")
                        gameState.spheres += 1*gameState.buildings[crew]
                    }
                }
            } else if(crew==="bridgeCrewsExtra"){
                const hasStormlight = gameState.stormlightStored >= gameState.buildings[crew] && gameState.upgrades["squiresUpgrade"];
                
                if(hasStormlight) {
                    gameState.stormlightStored -= gameState.buildings[crew];
                    // 5% death rate with stormlight
                    if (Math.random() >= 0.68 ){
                        console.log("Ded (with stormlight)")
                        if(gameState.buildings[crew]>0){
                            gameState.buildings[crew]--
                        }
                    } else {
                        console.log("Survived (with stormlight)")
                        gameState.spheres += 2*gameState.buildings[crew]
                    }
                } else {
                    // 85% death rate without stormlight
                    if (Math.random() >= 0.05){
                        console.log("Ded (no stormlight)")
                        if(gameState.buildings[crew]>0){
                            gameState.buildings[crew]--
                        }
                    } else {
                        console.log("Survived (no stormlight)")
                        gameState.spheres += 2*gameState.buildings[crew]
                    }
                }
            } else if(crew==="bridgeFour"){
                const hasStormlight = gameState.stormlightStored >= gameState.buildings[crew] && gameState.upgrades["squiresUpgrade"];
                
                if(hasStormlight) {
                    gameState.stormlightStored -= gameState.buildings[crew];
                    // 2% death rate with stormlight
                    if (Math.random() >= 0.38){
                        console.log("Ded (with stormlight)")
                        if(gameState.buildings[crew]>0){
                            gameState.buildings[crew]--
                        }
                    } else {
                        console.log("Survived (with stormlight)")
                        gameState.spheres += 4*gameState.buildings[crew]
                    }
                } else {
                    // 95% death rate without stormlight  
                    if (Math.random() >= 0.05){
                        console.log("Ded (no stormlight)")
                        if(gameState.buildings[crew]>0){
                            gameState.buildings[crew]--
                        }
                    } else {
                        console.log("Survived (no stormlight)")
                        gameState.spheres += 4*gameState.buildings[crew]
                    }
                }
            }
            // Update storm progress bar

            updateDisplay();
        }
        function getRandomInt(max) {
          return Math.floor(Math.random() * max);
        }
        function saveGame(){
            console.log("Saving Game!")
            localStorage.setItem('savedGame', JSON.stringify(gameState))
        }

        function loadGame() {
            const savedData = localStorage.getItem('savedGame');
            if (savedData) {
                const loadedState = JSON.parse(savedData);
                // Copy properties to your current gameState
                Object.assign(gameState, loadedState);
            }
        }
        function resetGame() {
            localStorage.removeItem('savedGame');
            location.reload(); // Reload the page to start fresh
        }

        //CALCULATE COST FUNCTION
        function calculateCost(key){
            var costModifier=gameState.costModifier;
            const building = buildingTypes[key];
            const currentCount = gameState.buildings[key];
            var baseCost =Math.floor(building.baseCost * Math.pow(1.15, currentCount));
            //console.log(baseCost*costModifier +" Price with modifier")
            //console.log(baseCost + " Price normal")
            return baseCost*costModifier;
        }
        //CALCULATE CLICK POWER FUNCTION
        function calculateClickPower(){
            var clickModifier= gameState.clickModifier
            var baseClickPower = gameState.clickPower
            //console.log(baseClickPower*clickModifier +" Click with modifier")
            //console.log(baseClickPower + " Click normal");
            return baseClickPower*clickModifier
        }
        /*
        try {
            const loadedState = JSON.parse(savedData);
            Object.assign(gameState, loadedState);
        } catch (error) {
            console.log("Save file corrupted, starting fresh");
        }
        */
    </script>
</body>
</html>

